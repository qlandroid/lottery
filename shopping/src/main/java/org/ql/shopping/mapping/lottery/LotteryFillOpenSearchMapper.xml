<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="org.ql.shopping.dao.lottery.LotteryFillOpenMapper">
	<resultMap type="org.ql.shopping.pojo.lottery.LotteryFillOpenSearch"
		id="SearchResultMap" extends="BaseResultMap">
		<result column="account" property="createUserName" jdbcType="VARCHAR" />
		<result column="bugQty" property="overBuyQty" jdbcType="VARCHAR" />
	</resultMap>

	<select id="selectByParams" resultMap="BaseResultMap"
		parameterType="org.ql.shopping.pojo.lottery.LotteryFillOpen">
		SELECT fill.lottery_fill_open_id,
		fill.open_number,
		fill.lottery_fill_creater_date,
		fill.lottery_fill_end_date,
		fill.create_user_id,
		fill.fill_l_bi,
		fill.award_l_bi,
		fill.send_status,
		fill.lottery_fill_unit_price,
		fill.lottery_type_id,
		fill.lottery_fill_name,
		fill.lottery_stage
		FROM lottery_fill_open fill
		<where>
			<include refid="WHERE_FILL_AND"></include>
		</where>
	</select>


	<select id="selectSearchByParams" resultMap="SearchResultMap"
		parameterType="org.ql.shopping.pojo.lottery.LotteryFillOpenSearch">
		SELECT fopen.lottery_fill_open_id,
		fopen.open_number,
		fopen.lottery_fill_creater_date,
		fopen.lottery_fill_end_date,
		fopen.create_user_id,
		fopen.fill_l_bi,
		fopen.award_l_bi,
		fopen.send_status,
		fopen.lottery_fill_unit_price,
		fopen.lottery_type_id,
		fopen.lottery_fill_name,
		fopen.lottery_stage,
		SUM(fuser.lottery_fill_buy_qty) AS bugQty,
		user_manager.account
		FROM
		lottery_fill_open fopen LEFT JOIN user_manager ON
		fopen.create_user_id
		= user_manager.id
		LEFT JOIN lottery_fill_user fuser
		ON
		fopen.lottery_fill_open_id = fuser.lottery_fill_open_id
		AND
		fuser.lottery_fill_status = '1'

		<where>
			<trim prefixOverrides="AND">
				<if test="openNumber != null">
					AND fopen.open_number =
					#{openNumber,jdbcType=VARCHAR}
				</if>
				<if test="createUserId != null">
					AND fopen.create_user_id =
					#{createUserId,jdbcType=INTEGER}
				</if>
				<if test="sendStatus != null">
					AND fopen.send_status =
					#{sendStatus,jdbcType=VARCHAR}
				</if>
				<if test="lotteryFillName != null">
					AND fopen.lottery_fill_name =
					#{lotteryFillName,jdbcType=VARCHAR}
				</if>
				<if test="lotteryStage != null">
					AND fopen.lottery_stage =
					#{lotteryStage,jdbcType=VARCHAR}
				</if>
				<if test="openNumber != null">
					AND fopen.open_number =
					#{openNumber,jdbcType=VARCHAR}
				</if>
				<if test="createUserName != null">
					AND user_manager.account =
					#{createUserName,jdbcType=VARCHAR}
				</if>
			</trim>
		</where>
		ORDER BY
		fopen.lottery_fill_creater_date
		LIMIT #{firstIndex},#{pageSize}
	</select>

	<select id="getSearchCountParams" resultType="java.lang.Integer"
		parameterType="org.ql.shopping.pojo.lottery.LotteryFillOpenSearch">
		SELECT count(*)
		FROM lottery_fill_open
		fill
		JOIN user_manager userM ON
		fill.create_user_id =
		userM.id
		<where>
			<include refid="WHERE_FILL_AND"></include>
			<trim prefixOverrides="AND">
				<if test="createUserName != null">
					AND userM.account =
					#{createUserName,jdbcType=VARCHAR}
				</if>

			</trim>
		</where>
	</select>

	<sql id="WHERE_FILL_AND">
		<trim prefixOverrides="AND">
			<if test="lotteryFillOpenId != null ">
				AND fill.lottery_fill_open_id =
				#{lotteryFillOpenId,jdbcType=INTEGER}
			</if>
			<if test="openNumber != null ">
				AND fill.open_number = #{openNumber,jdbcType=INTEGER}
			</if>
			<if test="lotteryFillCreaterDate != null ">
				AND fill.lottery_fill_creater_date =
				#{lotteryFillCreaterDate,jdbcType=TIMESTAMP}
			</if>
			<if test="createUserId != null ">
				AND fill.create_user_id =
				#{createUserId,jdbcType=INTEGER}
			</if>
			<if test="lotteryFillEndDate != null">
				AND fill.lottery_fill_end_date =
				#{lotteryFillEndDate,jdbcType=TIMESTAMP}
			</if>
			<if test="fillLBi != null">
				AND fill.fill_l_bi = #{fillLBi,jdbcType=INTEGER}
			</if>
			<if test="awardLBi != null">
				AND fill.award_l_bi = #{awardLBi,jdbcType=INTEGER}
			</if>
			<if test="sendStatus != null ">
				AND fill.send_status = #{sendStatus,jdbcType=VARCHAR}
			</if>
			<if test="lotteryFillUnitPrice != null ">
				AND fill.lottery_fill_unit_price =
				#{lotteryFillUnitPrice,jdbcType=INTEGER}
			</if>
			<if test="lotteryTypeId != null">
				AND fill.lottery_type_id =
				#{lotteryTypeId,jdbcType=INTEGER}
			</if>
			<if test="lotteryFillName != null">
				AND fill.lottery_fill_name =
				#{lotteryFillName,jdbcType=VARCHAR}
			</if>
			<if test="lotteryStage != null">
				AND fill.lottery_stage =
				#{lotteryStage,jdbcType=VARCHAR}
			</if>
		</trim>

	</sql>


</mapper>